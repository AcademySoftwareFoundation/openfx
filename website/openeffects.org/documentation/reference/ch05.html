<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></meta>
      <title>Chapter 5. Image Effect Contexts</title>
      <link rel="stylesheet" type="text/css" href="/assets/ofxStyle.css"></link>
      <meta name="generator" content="DocBook XSL Stylesheets V1.78.1"></meta>
      <link rel="home" href="/documentation/reference/index.html" title="The OFX Image Effect Plug-in API, 1.4, Programming Reference."></link>
      <link rel="up" href="/documentation/reference/index.html" title="The OFX Image Effect Plug-in API, 1.4, Programming Reference."></link>
      <link rel="prev" href="/documentation/reference/ch04s06.html" title="Simpler Architectures"></link>
      <link rel="next" href="/documentation/reference/ch05s02.html" title="The Filter Context"></link>
      <link rel="stylesheet" type="text/css" href="/assets/ofx-docbook-nav.css"></link>
   </head>
   <body>
      <div id="ofx-main-nav">
         <ul>
            <li>
               <a href="/">
                  <img alt="Ofx small" src="/assets/OFX_small.png"></img>
               </a>
            </li>
            <li>
               <a href="/">
                  Back to Main Site
                  <span class="glyph"></span>
               </a>
            </li>
            <li>
               <a href="/documentation/api_doc">API Reference</a>
            </li>
            <li>
               <a href="/documentation/reference">Programming Reference</a>
            </li>
            <li>
               <a href="https://github.com/ofxa/openfx/blob/master/Guide/Doc/ofxProgrammingGuide.adoc">Programming Guide</a>
            </li>
         </ul>
      </div>
      <div class="wrapper" id="reference">
         <div class="navheader">
            <table width="100%" summary="Navigation header">
               <tr>
                  <th colspan="3" align="center">Chapter 5. Image Effect Contexts</th>
               </tr>
               <tr>
                  <td width="20%" align="left">
                     <a accesskey="p" href="/documentation/reference/ch04s06.html">Prev</a>
                      
                  </td>
                  <th width="60%" align="center"> </th>
                  <td width="20%" align="right">
                      
                     <a accesskey="n" href="/documentation/reference/ch05s02.html">Next</a>
                  </td>
               </tr>
            </table>
            <hr></hr>
         </div>
         <div class="chapter">
            <div class="titlepage">
               <div>
                  <div>
                     <h1 class="title">
                        <a id="ImageEffectContexts"></a>
                        Chapter 5. Image Effect Contexts
                     </h1>
                  </div>
               </div>
            </div>
            <p>
               How an image effect is used by an end user affects how it should interact with a host application. For example an effect that is to be used as a transition between two clips works differently to an effect that is a simple filter. One must have two inputs and know how much to mix between the two input clips, the other has fewer constraints on it. Within OFX we have standardised several different uses and have called them
               <span class="emphasis">
                  <em>contexts</em>
               </span>
               .
            </p>
            <p>
      More specifically, a context mandates certain behaviours from an effect when it is described or instantiated in that 
      context. The major issue is the number of input clips it takes, and how it can interact with those input clips.
    </p>
            <p>
      All OFX contexts have a single output clip and zero or more input clips. The current contexts defined in OFX
      are..
      </p>
            <div class="itemizedlist">
               <ul class="itemizedlist" style="list-style-type: disc; ">
                  <li class="listitem">
                     <span class="emphasis">
                        <em>generator</em>
                     </span>
                     <div class="itemizedlist">
                        <ul class="itemizedlist" style="list-style-type: circle; ">
                           <li class="listitem">no compulsory input clips</li>
                           <li class="listitem">used by a host to create imagery from scratch, eg: a noise generator,</li>
                        </ul>
                     </div>
                  </li>
                  <li class="listitem">
                     <span class="emphasis">
                        <em>filter</em>
                     </span>
                     <div class="itemizedlist">
                        <ul class="itemizedlist" style="list-style-type: circle; ">
                           <li class="listitem">a single compulsory input clip</li>
                           <li class="listitem">a traditional 'filter effect' that transforms a single input in some way, eg: a simple blur</li>
                        </ul>
                     </div>
                  </li>
                  <li class="listitem">
                     <span class="emphasis">
                        <em>transition</em>
                     </span>
                     <div class="itemizedlist">
                        <ul class="itemizedlist" style="list-style-type: circle; ">
                           <li class="listitem">two compulsory input clips and a compulsory 'Transition' double parameter</li>
                           <li class="listitem">used to perform transitions between clips, typically in editing applications, eg: a cross dissolve,</li>
                        </ul>
                     </div>
                  </li>
                  <li class="listitem">
                     <span class="emphasis">
                        <em>paint effect</em>
                     </span>
                     <div class="itemizedlist">
                        <ul class="itemizedlist" style="list-style-type: circle; ">
                           <li class="listitem">two compulsory input clips, one image to paint onto, the other a mask to control where the effect happens,</li>
                           <li class="listitem">used by hosts to use an effect under a paint brush,</li>
                        </ul>
                     </div>
                  </li>
                  <li class="listitem">
                     <span class="emphasis">
                        <em>retimer</em>
                     </span>
                     <div class="itemizedlist">
                        <ul class="itemizedlist" style="list-style-type: circle; ">
                           <li class="listitem">a single compulsory input clip, and a compulsory 'SourceTime' double parameter,</li>
                           <li class="listitem">used by a host to change the playback speed of a clip,</li>
                        </ul>
                     </div>
                  </li>
                  <li class="listitem">
                     <span class="emphasis">
                        <em>general effect</em>
                     </span>
                     <div class="itemizedlist">
                        <ul class="itemizedlist" style="list-style-type: circle; ">
                           <li class="listitem">an arbitrary number of inputs,</li>
                           <li class="listitem">generally used in a 'tree' compositing environment,</li>
                           <li class="listitem">a catch all context.</li>
                        </ul>
                     </div>
                  </li>
               </ul>
            </div>
            <p>
    </p>
            <p>
      A host or plug-in need not support all contexts. For example a host that does not have any paint facility within it
      should not need to support the paint context, or a simple blur effect need not support the retimer context.
    </p>
            <p>
      An effect may say that it can be used in more than one context, for example a blur effect that acts as a filter, with a single input to blur,
      and a general effect, with an input to blur and an optional input to act as a mask to attenuate the blur. In such cases a host should choose
      the most appropriate context for the way that host's architecture. With our blur example, a tree based compositing host should 
      simply ignore the filter context and always use it in the general context. 
    </p>
            <p>
               Plugins and hosts inform each other what contexts they work in via the multidimensional
               <a class="link" href="/documentation/reference/re144.html" title="kOfxImageEffectPropSupportedContexts">
                  <code class="code">kOfxImageEffectPropSupportedContexts</code>
               </a>
               property. It must be set to at least one of the following values...
            </p>
            <div class="itemizedlist">
               <ul class="itemizedlist" style="list-style-type: disc; ">
                  <li class="listitem">
                     <code class="code">kOfxImageEffectContextGenerator</code>
                  </li>
                  <li class="listitem">
                     <code class="code">kOfxImageEffectContextFilter</code>
                  </li>
                  <li class="listitem">
                     <code class="code">kOfxImageEffectContextTransition</code>
                  </li>
                  <li class="listitem">
                     <code class="code">kOfxImageEffectContextPaint</code>
                  </li>
                  <li class="listitem">
                     <code class="code">kOfxImageEffectContextGeneral</code>
                  </li>
                  <li class="listitem">
                     <code class="code">kOfxImageEffectContextRetimer</code>
                  </li>
               </ul>
            </div>
            <p>
    </p>
            <p>
               A host indicates which contexts it supports by setting the
               <code class="code">kOfxImageEffectPropSupportedContexts</code>
               property in the global host descriptor. A plugin indicates which contexts it supports by setting this on the effect descriptor passed to the
               <a class="link" href="/documentation/reference/ch13s03.html" title="The Generic Describe Action">
                  <code class="code">kOfxActionDescribe</code>
               </a>
               action.
            </p>
            <p>
               Because a plugin can work in different ways, it needs the ability to describe itself to the host in different ways. This is the purpose of the
               <a class="link" href="/documentation/reference/ch13s12.html" title="The Describe In Context Action">
                  <code class="code">kOfxImageEffectActionDescribeInContext</code>
               </a>
               action. This action is called once for each context that the effect supports, and the effect gets to describe the input clips and parameters appropriate to that context. This means that an effect can have different sets of parameters and clips in different contexts, though it will most likely have a core set of parameters that it uses in all contexts. From our blur example, both the filter and general contexts would have a 'blur radius' parameter, but the general context might have an 'invert matte' parameter.
            </p>
            <p>
               During the
               <code class="code">kOfxImageEffectActionDescribeInContext</code>
               action, an effect must describe all clips and parameters that it intends to use. This includes the mandated clips and parameters for that context.
            </p>
            <p>
               A plugin instance is created in a specific contex which will not changed over the lifetime of that instance. The context can be retrieved from the instance via the
               <a class="link" href="/documentation/reference/re118.html" title="kOfxImageEffectPropContext">
                  <code class="code">kOfxImageEffectPropContext</code>
               </a>
               property on the instance handle.
            </p>
            <div class="section">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both">
                           <a id="kOfxImageEffectContextGenerator"></a>
                           The Generator Context
                        </h2>
                     </div>
                  </div>
               </div>
               <p>
	A generator context is for cases where a plugin can create images without any input clips, eg: a colour bar generator.
      </p>
               <p>
	In this context, a plugin has the following mandated clips,
	</p>
               <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: disc; ">
                     <li class="listitem">an output clip named 'Output'</li>
                  </ul>
               </div>
               <p>
      </p>
               <p>
	Any input clips that are specified must be optional.
      </p>
               <p>
	A host is responsible for setting the initial preferences of the output clip, it must do this in a manner that is 
	transparent to the plugin. So the pixel depths, components, fielding, frame rate and pixel aspect ratio are under the
	control of the host. How it arrives at these is a matter for the host, but as a plugin specifies what components it 
	can produce on output, as well as the pixel depths it supports, the host must choose one of these. 
      </p>
               <p>
	Generators still have Regions of Definition. This should generally be,
	</p>
               <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: disc; ">
                     <li class="listitem">based on the project size eg: an effect that renders a 3D sky simulation,</li>
                     <li class="listitem">based on parameter settings eg: an effect that renders a circle in an arbitrary location,</li>
                     <li class="listitem">infinite, which implies the effect can generate output anywhere on the image plane.</li>
                  </ul>
               </div>
               <p>
      </p>
               <p>
	The pixel preferences action is constrained in this context by the following,
	</p>
               <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: disc; ">
                     <li class="listitem">a plugin cannot change the component type of the 'Output' clip,</li>
                  </ul>
               </div>
               <p>
      </p>
            </div>
         </div>
         <div class="navfooter">
            <hr></hr>
            <table width="100%" summary="Navigation footer">
               <tr>
                  <td width="40%" align="left">
                     <a accesskey="p" href="/documentation/reference/ch04s06.html">Prev</a>
                      
                  </td>
                  <td width="20%" align="center"> </td>
                  <td width="40%" align="right">
                      
                     <a accesskey="n" href="/documentation/reference/ch05s02.html">Next</a>
                  </td>
               </tr>
               <tr>
                  <td width="40%" align="left" valign="top">Simpler Architectures </td>
                  <td width="20%" align="center">
                     <a accesskey="h" href="/documentation/reference/index.html">Home</a>
                  </td>
                  <td width="40%" align="right" valign="top"> The Filter Context</td>
               </tr>
            </table>
         </div>
      </div>
   </body>
</html>
