<!DOCTYPE html>
<html>
<head>
<title> Standard Changes Multi View Effects |  The Open Effects Association</title>
<link rel="shortcut icon" type="image/x-icon" href="/assets/ofx_favicon-c6cb586c0f8efbaeff3167d1fd7cfca2.ico" />
<link rel="stylesheet" media="all" href="/assets/application-8fbc3aa4b380a52e15d414a59177d3a2.css" />
<script src="/assets/application-f474998312dbf9d63cf3d555583ac5a1.js"></script>
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="/0YEHhqab8X+X/lTKPbnN6aqAzBT5jvM7vjHSEcBFCvRXGytvK5i6kuAu75cxFzj84p3dQqbHS4g+dMlUlAVEA==" />
<meta content='IE=edge' http_equiv='X-UA-Compatible'>
<meta content='width=device-width, initial-scale=1' name='viewport'>
<script src='//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js'></script>
</head>
<body class='c_standard_changes a_show' data-spy='scroll' data-target='.navbar-top' role='document'>
<div class='modal fade' id='terminal'>
<div class='modal-dialog modal-lg'>
<div class='modal-content'>
<div class='modal-header'>
<div aria-hidden='true' class='button close' data-dismiss='modal' type='button'>&times;</div>
<h4 class='modal-title'>Terminal Output</h4>
</div>
<div class='modal-body'>
<div class='window'></div>
</div>
</div>
</div>
</div>
<div class='wrapper'>
<div class='navbar navbar-inverse navbar-fixed-top' role='components'>
<div class='container'>
<div class='navbar-header'>
<button class='navbar-toggle' data-target='.navbar-collapse' data-toggle='collapse' type='button'>
<span class='sr-only'>Toggle components</span>
<span class='icon-bar'></span>
<span class='icon-bar'></span>
<span class='icon-bar'></span>
</button>
</div>
<div class='navbar-collapse collapse'>
<div class='row'>
<div class='navbar-left'>
<div class='navbar-top'>
<div class='mobile'>
<ul class='nav navbar-nav'>
<li><a href="/">Welcome</a></li>
<li><a class="navbar-link" href="/standard_changes">Standards Discussion</a></li>
<li><a class="navbar-link" href="/contact_form">Contact</a></li>
</ul>
</div>
<div class='desktop'>
<ul class='nav navbar-nav'>
<li class='nav-logo'>
<a class="navbar-link" href="/"><img src="/assets/OFX_small-41bc647075217376f758003aebeacf15.png" alt="Ofx small" /></a>
</li>
<li class='dropdown'>
<a href="/">Welcome <span class="glyphicon glyphicon-circle-arrow-left"></span></a>
<ul class='dropdown-menu inverse-dropdown'>
<li>
<a class="navbar-link" href="#standard">Why a Standard?</a>
</li>
<li>
<a class="navbar-link" href="#implementers">For Implementers</a>
</li>
<li>
<a class="navbar-link" href="#organization">Association Business</a>
</li>
</ul>
</li>
<li class='dropdown api'>
<a class='navbar-link'>API Documentation <span class="glyphicon glyphicon-circle-arrow-down"></span></a>
<ul class='dropdown-menu inverse-dropdown'>
<li>
<a class="navbar-link" target="_blank" href="/documentation/api_doc">API Reference</a>
</li>
<li>
<a class="navbar-link" target="_blank" href="https://openfx.readthedocs.io/en/doc/Reference/index.html">Programming Reference</a>
</li>
<li>
<a class="navbar-link" target="_blank" href="https://openfx.readthedocs.io/en/doc/Guide/index.html">Programming Guide</a>
</li>
</ul>
</li>
<li><a class="navbar-link" href="/standard_changes">Standards Discussion</a></li>
<li><a class="navbar-link" href="/contact_form">Contact</a></li>
</ul>
</div>
</div>
</div>
<div class='desktop'>

</div>
</div>
</div>
</div>
</div>
<div class='container' role='main'>
</div>
<div class='container'>
<div class='row'>
<div class='col-md-offset-2 col-md-8'>
<div class='btn-group'>
<a type="button" class="btn btn-default" href="/standard_changes"><span class='glyphicon glyphicon-circle-arrow-left'></span> Back to standard change list</a>
</div>

<br>
<br>
<div class='panel panel-warning'>
<div class='panel-heading'>
<h3 class='panel-title'>
Multi View Effects
<span class='pull-right'>Proposed</span>
</h3>
</div>
<div class='panel-body'>
<p>
<b>Standard version:</b>
1.5
</p>
<p>
<b>Minor Change</b>
</p>
<label>Subcommittee</label>
<p></p>
<label>Overview</label>
<p>Stereo motion pictures are now common, and various visual effects applications have been updated to include a stereo work flow. Typically this is done by embedding multiple views within an image stream.</p>
<p>The Foundry has implemented an unpublished extension to the OFX API in its Nuke compositing application to deal with multiple views within a clip. We are proposing cleaned up versions of these extensions to the OFX 2.0 Committee for adoption in the Image Effect API. It should work along side the Deep Images proposal.</p>
<p>An extra concept needs to be added to the API, which is a view, this a set of planes, for example the left view and the right view.</p>
<p>The basic idea behind this extension is orthogonal to the plane being fetched, as well as time. So when an effect fetches image data from the host it would specify the frame time, the view and the image plane to fetch, eg: the source clip's the colour plane of frame 10 of the left view.</p>
<p>The extensions will need supporting machinery, so that plug-ins advertise what views they process and need to render an output and so on.</p>
<p>The multi-view API would be an optional extension for host applications that support stereo streams.</p>
<label>Solution</label>
<p>An image stream in our proposed scheme is a fat hierarchical bundle of image data. Each clip has multiple frames, at each frame we have a set of views each of which consists of a set of image planes. The set of planes on each view are identical.</p>
<p>Not all effects need to be view aware, for example a simple blur plugin does not need to know which view is it being asked to process, it simply fetches the planes it is blurring, some parameter values and renders its outputs. View aware hosts have a straight forward problem to support such plugin.</p>
<p>View aware plug-ins are those that explicitly use images from more than one view to produce an output image. To enable such plug-ins to work, we need to extend the image effect API in a fairly straight forward manner,</p>
<ul>
<li>plugins and host need to advertise their view awareness,</li>
<li>plugins need to be able to ask how many views are present,</li>
<li>when fetching an image, a view needs to be specified,</li>
<li>plugins need to state what input views are needed to produce an output view,</li>
<li>at render, a plugin is told to produce a set of planes, at a specific time for a specific view.</li>
</ul>
<p>All clips are considered to have all enumerated views, so that a plugin can fetch any view from any clip. A host may only have a single view available on that clip, in which case it should return the same image for either view. Unless a plugin sets itself to be view invariant it is expected that multiple calls to render will occur for each view.</p>
<p>A new, optional suite, OfxImageEffectViewSuite, will be needed to support this.</p>
<h3 id="identifying_views">Identifying Views</h3>
<p>Views are passed around as indices, from 0 to nViews-1. The number and name of views can be recovered via functions on the view suite.</p>
<p>The one dimensional integer property kOfxImageEffectPropView is often used to identify a single view on various property sets.</p>
<h3 id="view_awareness">View Awareness</h3>
<p>A plugin and host advertise their view awareness via the descriptor property, kOfxImageEffectPropViewAware. This is a one dimensional integer property, set to zero if not view aware, or one if it is.</p>
<p>If this property does not exist on a descriptor (indicated by any of the property manipulation functions returning kOfxStatErrUnknown) then the corresponding host should not be considered view aware.</p>
</div>
</div>
<div class='btn-group'>
<a type="button" class="btn btn-default" href="/standard_changes"><span class='glyphicon glyphicon-circle-arrow-left'></span> Back to standard change list</a>
</div>

<br>
<br>
<div class='panel panel-default'>
<div class='panel-body'>
<h4 class='text-primary'>Discussion</h4>
<h5>Comments</h5>
<div class='well well-sm'>
<div class='comment user-0' id='cid-210'>
<div class='content'>
<p>[pierre jasmin]: This is a bit complicated, perhaps we can ignore planes for now as a first pass?</p>
<p>Don't we only need something like:</p>
<pre><span>typedef</span><span>struct</span>
               OfxMultiViewImageEffectSuiteV1
               <span>{</span>
               OfxStatus
               <span>(</span>
               <span>*</span>
               clipGetMultiViewImage
               <span>)</span>
               <span>(</span>
               OfxImageClipHandle clip
               <span>,</span>
               OfxTime
               <a href="http://www.opengroup.org/onlinepubs/009695399/functions/time.html"><span>time</span></a>
               <span>,</span>
               <span>int</span>
               iview
               <span>,</span>
               OfxRectD
               <span>*</span>
               region
               <span>,</span>
               OfxPropertySetHandle
               <span>*</span>
               imageHandle
               <span>)</span>
               <span>;</span>
               OfxStatus
               <span>(</span>
               <span>*</span>
               getViewCount
               <span>)</span>
               <span>(</span>
               OfxImageEffectHandle instance
               <span>,</span>
               <span>int</span>
               <span>*</span>
               nViews
               <span>)</span>
               <span>;</span>
               <span>// 2 when stereo</span>
               OfxStatus
               <span>(</span>
               <span>*</span>
               getViewName
               <span>)</span>
               <span>(</span>
               OfxImageEffectHandle effect
               <span>,</span>
               <span>int</span>
               view
               <span>,</span>
               <span>char</span>
               <span>**</span>
               viewName
               <span>)</span>
               <span>;</span>
               <span>}</span>
               OfxMultiViewImageSuiteV1
               <span>;</span>
            </pre>
<p>+ maybe we need to say we support this, I am OK if I have to add a menu (process both, left only, right only - assuming I can get both views when rendering one)
Also if getViewCount == 2 - maybe we can use predefined int values:  ALL=0, LEFT=1, RIGHT=2?</p>
<p>[Gary Oberbrunner]: Like Pierre, I think a simple interface is better if it serves the need.  Handling stereo is all we really need to do here, right?  Being able to get disparity from the host would be nice, but (a) some hosts, even stereo-capable ones, might not have that, and (b) most plug-ins just need the actual left and right images.</p>
<p>One additional comment: what if we are in direct OpenGL mode?  This suite has to interoperate with that one.</p>
<p>&#8212;</p>
<p>[Dennis Adams]: There are two needs that we identified:</p>
<ol>
<li> Some stereo-aware plug-ins would like to know which view it is currently processing.</li>
<li>
                  Some stereo-aware plug-ins would like access to frames from views
                  <em>other</em>
                  than the one it is processing.
               </li>
</ol>
<p>We addressed these in Vegas Pro 10 using the following (shipping) OFX extensions:</p>
<p>1. Two new properties of the OfxImageEffectActionRender action describing the view being rendered, and how many views total:</p>
<pre><span>/** @brief Indicates the number of the view to render

       - Type - int x 1
       - Property Set - Render In Args (read only)
       - Valid Values - 0 (standard), 0 (left stereoscopic processing), 1 (right stereoscopic processing)

    */</span><span>#define kOfxImageEffectPropRenderView OfxImageEffectPropRenderView</span><span>/** @brief Indicates the number of total views to render

       - Type - int x 1
       - Property Set - Render In Args (read only)
       - Valid Values - 1 (standard), 2 (stereoscopic processing)

    */</span><span>#define kOfxImageEffectPropViewsToRender OfxImageEffectPropViewsToRender</span></pre>
<p>2. Callback suite to get a specific view (using the standard callback gets you the current view being rendered):</p>
<pre><span>/** @brief Name of the Vegas stereoscopic image effect suite (used to get a clip image from the
               either view (otherwise getClipImage by default returns the current image)
    */</span><span>#define kOfxVegasStereoscopicImageEffectSuite OfxVegasStereoscopicImageEffectSuite</span><span>typedef</span><span>struct</span>
               OfxVegasStereoscopicImageEffectSuiteV1
               <span>{</span>
               OfxStatus
               <span>(</span>
               <span>*</span>
               clipGetStereoscopicImage
               <span>)</span>
               <span>(</span>
               OfxImageClipHandle clip
               <span>,</span>
               OfxTime
               <a href="http://www.opengroup.org/onlinepubs/009695399/functions/time.html"><span>time</span></a>
               <span>,</span>
               <span>int</span>
               iview
               <span>,</span>
               OfxRectD
               <span>*</span>
               region
               <span>,</span>
               OfxPropertySetHandle
               <span>*</span>
               imageHandle
               <span>)</span>
               <span>;</span>
               <span>}</span>
               OfxVegasStereoscopicImageSuiteV1
               <span>;</span>
            </pre>
<p>Both of these seem to fit inside what Bruno has proposed (based on how Nuke works), but using numbers instead of names for the views.</p>
<p>To Gary's comment, these are compatible with the OpenGL extension and can be used at the same time.</p>
<p>Regarding taking it past stereoscopic: we may need a convention for describing views. For example, views needed for:</p>
<ol>
<li> Stereoscopic (left and right).</li>
<li> Autostereoscopic displays (I've seen these with 4 to 15 views, probably more someday).</li>
<li>
                  360 displays like Sony RayModeler (
                  <a href="http://www.youtube.com/watch?v=6BFKC-NKRFw" title="http://www.youtube.com/watch?v=6BFKC-NKRFw" rel="nofollow">http://www.youtube.com/watch?v=6BFKC-NKRFw</a>
                  ).
               </li>
<li> Multiple views in both X and Y view directions?</li>
</ol>
<p>All of these can be sufficiently enumerated just with &#8220;view N of M&#8221; (or &#8220;view Nx,Ny of Mx,My&#8221; for #4) but for 2 and 3 you might want to know the angle described by each view.</p>
<p>[pierre jasmin]: I don't think we want decimation, tiling etc in there. Just maybe Stereo and Other.</p>
<p>Conceptually seems we need to separate &#8220;Planes&#8221; - multi-channel from multi-view</p>
<p>OfxStatus (* clipGetImagePlane)(OfxImageClipHandle    clip,</p>
<pre>                                OfxTime               time,
                                const char*           plane,
                                OfxRectD*             region,
                                OfxPropertySetHandle* imageHandle);</pre>
<p>OfxStatus (*clipGetImageView)(OfxImageClipHandle clip,</p>
<pre>                    OfxTime       time,
                    int           iview,
                    OfxRectD     *region,
                    OfxPropertySetHandle   *imageHandle);</pre>
<p>OfxStatus (* clipGetImageViewAndPlane)(OfxImageClipHandle    clip,</p>
<pre>                                OfxTime               time,
                                int                   view,
                                const char*           plane,
                                OfxRectD*             region,
                                OfxPropertySetHandle* imageHandle);</pre>
</div>
</div>
<div class='author text-muted'>
unattributed |  9:49 am,   8 Mar 2014
</div>
</div>

</div>
</div>

<div class='btn-group'>
<a type="button" class="btn btn-default" href="/standard_changes"><span class='glyphicon glyphicon-circle-arrow-left'></span> Back to standard change list</a>
</div>

</div>
</div>
</div>

<div class='push'></div>
</div>
<footer>
<ul class='footer-link-group'>
<li>
<a target="_blank" class="footer-link" href="https://github.com/ofxa/openfx">OFX @ Github</a>
</li>
<li>
<a title="Association details" class="footer-link" href="/contents/page/association_information">Association Information</a>
</li>
</ul>
<br>
Copyright  &copy;2023 The Open Effects Association
</footer>
</body>
</html>
