<!DOCTYPE html>
<html>
<head>
<title> Standard Changes Opengl Suite V2 |  The Open Effects Association</title>
<link rel="shortcut icon" type="image/x-icon" href="/assets/ofx_favicon-c6cb586c0f8efbaeff3167d1fd7cfca2.ico" />
<link rel="stylesheet" media="all" href="/assets/application-8fbc3aa4b380a52e15d414a59177d3a2.css" />
<script src="/assets/application-f474998312dbf9d63cf3d555583ac5a1.js"></script>
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="7/DN+evralM537WCB1vdRJgsXQMAi9Zzw77lR0LHdxPB6qVKTd9nfIwA929zaWaQzQwpRln28JENv/EqV5Z2KA==" />
<meta content='IE=edge' http_equiv='X-UA-Compatible'>
<meta content='width=device-width, initial-scale=1' name='viewport'>
<script src='//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js'></script>
</head>
<body class='c_standard_changes a_show' data-spy='scroll' data-target='.navbar-top' role='document'>
<div class='modal fade' id='terminal'>
<div class='modal-dialog modal-lg'>
<div class='modal-content'>
<div class='modal-header'>
<div aria-hidden='true' class='button close' data-dismiss='modal' type='button'>&times;</div>
<h4 class='modal-title'>Terminal Output</h4>
</div>
<div class='modal-body'>
<div class='window'></div>
</div>
</div>
</div>
</div>
<div class='wrapper'>
<div class='navbar navbar-inverse navbar-fixed-top' role='components'>
<div class='container'>
<div class='navbar-header'>
<button class='navbar-toggle' data-target='.navbar-collapse' data-toggle='collapse' type='button'>
<span class='sr-only'>Toggle components</span>
<span class='icon-bar'></span>
<span class='icon-bar'></span>
<span class='icon-bar'></span>
</button>
</div>
<div class='navbar-collapse collapse'>
<div class='row'>
<div class='navbar-left'>
<div class='navbar-top'>
<div class='mobile'>
<ul class='nav navbar-nav'>
<li><a href="/">Welcome</a></li>
<li><a class="navbar-link" href="/standard_changes">Standards Discussion</a></li>
<li><a class="navbar-link" href="/contact_form">Contact</a></li>
</ul>
</div>
<div class='desktop'>
<ul class='nav navbar-nav'>
<li class='nav-logo'>
<a class="navbar-link" href="/"><img src="/assets/OFX_small-41bc647075217376f758003aebeacf15.png" alt="Ofx small" /></a>
</li>
<li class='dropdown'>
<a href="/">Welcome <span class="glyphicon glyphicon-circle-arrow-left"></span></a>
<ul class='dropdown-menu inverse-dropdown'>
<li>
<a class="navbar-link" href="#standard">Why a Standard?</a>
</li>
<li>
<a class="navbar-link" href="#implementers">For Implementers</a>
</li>
<li>
<a class="navbar-link" href="#organization">Association Business</a>
</li>
</ul>
</li>
<li class='dropdown api'>
<a class='navbar-link'>API Documentation <span class="glyphicon glyphicon-circle-arrow-down"></span></a>
<ul class='dropdown-menu inverse-dropdown'>
<li>
<a class="navbar-link" target="_blank" href="/documentation/api_doc">API Reference</a>
</li>
<li>
<a class="navbar-link" target="_blank" href="https://openfx.readthedocs.io/en/doc/Reference/index.html">Programming Reference</a>
</li>
<li>
<a class="navbar-link" target="_blank" href="https://openfx.readthedocs.io/en/doc/Guide/index.html">Programming Guide</a>
</li>
</ul>
</li>
<li><a class="navbar-link" href="/standard_changes">Standards Discussion</a></li>
<li><a class="navbar-link" href="/contact_form">Contact</a></li>
</ul>
</div>
</div>
</div>
<div class='desktop'>
<form role="form" class="navbar-form navbar-right form-inline" action="/users/sign_in" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="authenticity_token" value="9mcIiYlqIbXuYqDUjg90vW/xo/TS9J/v6LpIoNqONaHYfWA6L14smlu94jn6Pc9pOtHXsYuJuQ0mu1zNz980mg==" />
<div class='form-group'>
<input type="text" name="user[email]" id="user_email" class="form-control input-xs" placeholder="Email" />
</div>
<div class='form-group'>
<input type="password" name="user[password]" id="user_password" class="form-control input-xs" placeholder="Password" />
</div>
<button class='btn btn-sm btn-primary' type='submit'>Sign in</button>
</form>

</div>
</div>
</div>
</div>
</div>
<div class='container' role='main'>
</div>
<div class='container'>
<div class='row'>
<div class='col-md-offset-2 col-md-8'>
<div class='btn-group'>
<a type="button" class="btn btn-default" href="/standard_changes"><span class='glyphicon glyphicon-circle-arrow-left'></span> Back to standard change list</a>
</div>

<br>
<br>
<div class='panel panel-warning'>
<div class='panel-heading'>
<h3 class='panel-title'>
OpenGL suite V2
<span class='pull-right'>Proposed</span>
</h3>
</div>
<div class='panel-body'>
<p>
<b>Standard version:</b>
1.5
</p>
<p>
<b>Major Change</b>
</p>
<label>Subcommittee</label>
<p><p>Alexandre Gauthier (Inria/Natron),&nbsp; Peter Litwinowicz (RE:Vision Effects)</p></p>
<label>Overview</label>
<p>1) Flushing in current V1 suite is likely to be addressed via GPU utility suite.&nbsp; It has become not sufficient in an age where a GPU can have 24 GB of VRAM.</p>
<p>2) The currently suggested fallback in documentation are likely to be superseeded by a GPU utility suite fallback hand shake</p>
<p>3) Option to disable/enable suite in Instance Changed action is not well documented in v1.4</p>
<p>4) Multi-Threading (locking) is currently not addressed by V1 suite.</p>
<p>From Alexandre email:</p>
<p>"</p>
<div>What we were trying to achieve is multi-frame rendering by giving each frame it&rsquo;s own OpenGL context (internally we have an OpenGL context pool).&nbsp; When a frame starts to be rendered, it locks the context to that frame and releases it when done.&nbsp;</div>
<div>&nbsp;</div>
<div>The issue is: Since frames are rendered concurrently, the host could be calling contextAttached/contextDettached actions at the same time with 2 different contexts. But the spec forbids 2 subsequent calls to contextAttached without the associated contextDettached. Meaning the spec forbids multi-threaded rendering with OpenGL since a thread would just be locking the whole render.</div>
<div>&nbsp;</div>
<div>So what we ended up to do, is:</div>
<div>&nbsp;</div>
<div>1) Lock the call to contextAttached</div>
<div>2) Add the following property :</div>
<div>&nbsp;</div>
<div>
<div>
<div style="margin: 0px; font-size: 11px; line-height: normal; font-family: Menlo;"><span>/** @brief A pointer property used to hold OpenGL context-specific data, such as texture or program IDs.</span></div>
<div style="margin: 0px; font-size: 11px; line-height: normal; font-family: Menlo; min-height: 13px;">&nbsp;</div>
<div style="margin: 0px; font-size: 11px; line-height: normal; font-family: Menlo;"><span>&nbsp;&nbsp; - Type - pointer X 1</span></div>
<div style="margin: 0px; font-size: 11px; line-height: normal; font-family: Menlo;"><span>&nbsp;&nbsp; - Property Set - inArgs property set of the following actions...</span></div>
<div style="margin: 0px; font-size: 11px; line-height: normal; font-family: Menlo;"><span>&nbsp; &nbsp; &nbsp; - ::kOfxImageEffectActionRender</span></div>
<div style="margin: 0px; font-size: 11px; line-height: normal; font-family: Menlo;"><span>&nbsp; &nbsp; &nbsp; - ::kOfxImageEffectActionBeginSequenceRender</span></div>
<div style="margin: 0px; font-size: 11px; line-height: normal; font-family: Menlo;"><span>&nbsp; &nbsp; &nbsp; - ::kOfxImageEffectActionEndSequenceRender</span></div>
<div style="margin: 0px; font-size: 11px; line-height: normal; font-family: Menlo;"><span>&nbsp; &nbsp; &nbsp; - ::kOfxActionOpenGLContextDetached</span></div>
<div style="margin: 0px; font-size: 11px; line-height: normal; font-family: Menlo;"><span>&nbsp;&nbsp; &nbsp; - outArgs property set of the following actions...</span></div>
<div style="margin: 0px; font-size: 11px; line-height: normal; font-family: Menlo;"><span>&nbsp; &nbsp; &nbsp; - ::kOfxActionOpenGLContextAttached</span></div>
<div style="margin: 0px; font-size: 11px; line-height: normal; font-family: Menlo;"><span>&nbsp;&nbsp; - Default - NULL</span></div>
<div style="margin: 0px; font-size: 11px; line-height: normal; font-family: Menlo; min-height: 13px;">&nbsp;</div>
<div style="margin: 0px; font-size: 11px; line-height: normal; font-family: Menlo;"><span>This pointer is a handle to plugin-owned data holding OpenGL context-specific data</span></div>
<div style="margin: 0px; font-size: 11px; line-height: normal; font-family: Menlo;"><span>(e.g. texture or program IDs). This is returned by the plugin when the context is first</span></div>
<div style="margin: 0px; font-size: 11px; line-height: normal; font-family: Menlo;"><span>attached, and then passed as inArgs to each render call in that context. This permits running</span></div>
<div style="margin: 0px; font-size: 11px; line-height: normal; font-family: Menlo;"><span>several parallel renders on different OpenGL contexts, but it violates the OpenFX spec, which</span></div>
<div style="margin: 0px; font-size: 11px; line-height: normal; font-family: Menlo;"><span>says:</span></div>
<div style="margin: 0px; font-size: 11px; line-height: normal; font-family: Menlo; min-height: 13px;">&nbsp;</div>
<div style="margin: 0px; font-size: 11px; line-height: normal; font-family: Menlo;"><span>&nbsp;"A host cannot call ::kOfxActionOpenGLContextAttached on the same instance</span></div>
<div style="margin: 0px; font-size: 11px; line-height: normal; font-family: Menlo;"><span>&nbsp;without an intervening ::kOfxActionOpenGLContextDetached. A host can have a</span></div>
<div style="margin: 0px; font-size: 11px; line-height: normal; font-family: Menlo;"><span>&nbsp;plugin swap OpenGL contexts by issuing a attach/detach for the first context</span></div>
<div style="margin: 0px; font-size: 11px; line-height: normal; font-family: Menlo;"><span>&nbsp;then another attach for the next context."</span></div>
<div style="margin: 0px; font-size: 11px; line-height: normal; font-family: Menlo; min-height: 13px;">&nbsp;</div>
<div style="margin: 0px; font-size: 11px; line-height: normal; font-family: Menlo;"><span>&nbsp;If the plugin returns NULL as outArgs of kOfxActionOpenGLContextDetached, it is supposed</span></div>
<div style="margin: 0px; font-size: 11px; line-height: normal; font-family: Menlo;"><span>&nbsp;to follow the OpenFX spec, and will have to be detached/attached when switching the render context.</span></div>
<div style="margin: 0px; font-size: 11px; line-height: normal; font-family: Menlo; min-height: 13px;">&nbsp;</div>
<div style="margin: 0px; font-size: 11px; line-height: normal; font-family: Menlo;"><span>&nbsp;*/</span></div>
<div style="margin: 0px; font-size: 11px; line-height: normal; font-family: Menlo;"><span>#define kNatronOfxImageEffectPropOpenGLContextData </span><span>"NatronOfxImageEffectPropOpenGLContextData"</span></div>
</div>
<div><span>&nbsp;</span></div>
<div>
<div>If the plug-in sets the pointer to a non NULL value, we know it can perform multi-threaded OpenGL, and then we just call concurrently the contextAttach/contextDettach actions in completely random orders.</div>
<div>&nbsp;</div>
<div>Also it enables us to not free immediately the resources allocated in contextAttach right away after the render (by calling contextDettach) since our OpenGL contexts are pooled. We can cache these datas away.</div>
</div>
</div>
<label>Solution</label>

</div>
</div>
<div class='btn-group'>
<a type="button" class="btn btn-default" href="/standard_changes"><span class='glyphicon glyphicon-circle-arrow-left'></span> Back to standard change list</a>
</div>

<br>
<br>
<div class='panel panel-default'>
<div class='panel-body'>
<h4 class='text-primary'>Discussion</h4>
<p>No comments on this change yet</p>
</div>
</div>

<div class='btn-group'>
<a type="button" class="btn btn-default" href="/standard_changes"><span class='glyphicon glyphicon-circle-arrow-left'></span> Back to standard change list</a>
</div>

</div>
</div>
</div>

<div class='push'></div>
</div>
<footer>
<ul class='footer-link-group'>
<li>
<a target="_blank" class="footer-link" href="https://github.com/ofxa/openfx">OFX @ Github</a>
</li>
<li>
<a title="Association details" class="footer-link" href="/contents/page/association_information">Association Information</a>
</li>
</ul>
<br>
Copyright  &copy;2023 The Open Effects Association
</footer>
</body>
</html>
